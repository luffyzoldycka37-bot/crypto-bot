import requests
from telegram.ext import Updater, CommandHandler

TOKEN = "7993942640:AAHgJ1a4KLKwc23trpWzTSbjlMryVhADnEA"

def get_ton_price_usd():
    url = "https://api.coingecko.com/api/v3/simple/price?ids=toncoin&vs_currencies=usd"
    try:
        response = requests.get(url, timeout=10)
        data = response.json()
        return data["toncoin"]["usd"]
    except Exception:
        return None

def get_exchange_rates():
    asia_rate = 2500    # Ø³Ø¹Ø± Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø¯ÙŠÙ†Ø§Ø± Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ (Ø§Ù„Ø£Ø³ÙŠØ§)
    master_rate = 2600  # Ø³Ø¹Ø± Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ù…Ø§Ø³ØªØ± Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ
    usd_rate = 1        # Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ù†ÙØ³Ù‡
    return asia_rate, master_rate, usd_rate

def prices(update, context):
    ton_usd = get_ton_price_usd()
    asia_rate, master_rate, usd_rate = get_exchange_rates()

    if ton_usd is None:
        update.message.reply_text("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø¬Ù„Ø¨ Ø³Ø¹Ø± TON Ø§Ù„Ø¢Ù†. Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ù‹Ø§.")
        return

    usd_in_asia = 1 * asia_rate
    usd_in_master = 1 * master_rate

    ton_in_usd = ton_usd * usd_rate
    ton_in_asia = ton_usd * asia_rate
    ton_in_master = ton_usd * master_rate

    message = (
        f"ğŸ’µ Ø³Ø¹Ø± Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ (USD):\n"
        f" - Ø¨Ø§Ù„Ø£Ø³ÙŠØ§ Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ: {usd_in_asia:,.0f} IQD\n"
        f" - Ø¨Ø§Ù„Ù…Ø§Ø³ØªØ± Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ: {usd_in_master:,.0f} IQD\n\n"
        f"ğŸ”· Ø³Ø¹Ø± Ø¹Ù…Ù„Ø© TON:\n"
        f" - Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ: {ton_in_usd:.2f} USD\n"
        f" - Ø¨Ø§Ù„Ø£Ø³ÙŠØ§ Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ: {ton_in_asia:,.0f} IQD\n"
        f" - Ø¨Ø§Ù„Ù…Ø§Ø³ØªØ± Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ: {ton_in_master:,.0f} IQD\n"
    )
    update.message.reply_text(message)

def main():
    updater = Updater(TOKEN)
    dp = updater.dispatcher
    dp.add_handler(CommandHandler("prices", prices))

    updater.start_polling()
    updater.idle()

if __name__ == "__main__":
    main()
